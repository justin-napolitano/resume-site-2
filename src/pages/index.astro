---
import r from "../data/resume.json";

const SHOW_EMAIL = false; // you included it in JSON; flip true if you want it visible
const SHOW_PHONE = false; // flip true if you want it visible

const h = r.header;
const DOT_COUNT = 5;
const highlightSkills = r.skill_highlights ?? [];
const highlightNames = new Set(
  highlightSkills.flatMap((s) => s.items?.map((i) => i.name) ?? [])
);
const fullSkillAreas = (r.skills ?? [])
  .map((area) => ({
    ...area,
    items: area.items?.filter((i) => !highlightNames.has(i.name)) ?? [],
  }))
  .filter((area) => area.items.length > 0);
const levelMap: Record<string, string> = {
  "5": "Principal",
  "4": "Senior",
  "3": "Mid-level",
  "2": "Associate",
  "1": "Foundational",
};

const clampYearsForDots = (years: number = 0) => {
  const safeYears = Math.floor(years);
  return Math.max(0, Math.min(DOT_COUNT, safeYears));
};

const labelForLevel = (level: number | undefined) => {
  if (typeof level === "undefined") return "";
  return levelMap[String(level)] ?? `Level ${level}`;
};
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{h.name} — Resume</title>

    <meta name="description" content={`${h.name} — Resume`} />
    <link rel="canonical" href="https://www.justin-napolitano.com/resume/" />

    <!-- OpenGraph (optional but nice) -->
    <meta property="og:title" content={`${h.name} — Resume`} />
    <meta property="og:description" content={`${h.name} — Resume`} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.justin-napolitano.com/resume/" />
    <meta property="og:image" content="https://www.justin-napolitano.com/images/og.png" />

    <link rel="stylesheet" href="/resume.css" />
  </head>

  <body>
    <main class="page">
      <header class="top">
        <div class="id">
          <h1>{h.name}</h1>
          <div class="meta">
            {h.location && <span>{h.location}</span>}
            {(SHOW_EMAIL && h.email) && <span> • <a href={`mailto:${h.email}`}>{h.email}</a></span>}
            {(SHOW_PHONE && h.phone) && <span> • <a href={`tel:${h.phone}`}>{h.phone}</a></span>}
          </div>

          <div class="meta">
            {h.linkedin_url && <a class="link" href={h.linkedin_url} target="_blank" rel="noopener">LinkedIn</a>}
            {h.github_url && <a class="link" href={h.github_url} target="_blank" rel="noopener">GitHub</a>}
          </div>
        </div>

        <div class="actions">
          <a class="btn" href="/resume.pdf" download>Download PDF</a>
        </div>
      </header>

      {r.summary?.length > 0 && (
        <section>
          <h2>Summary</h2>
          <ul>
            {r.summary.map((s) => <li>{s}</li>)}
          </ul>
        </section>
      )}

      {highlightSkills?.length > 0 && (
        <section class="skillsSection">
          <h2>Platform Highlights</h2>
          <p class="skillLegend">1 dot = 1 year of experience</p>

          <div class="skillsGrid">
            {highlightSkills.map((s) => (
              <article class="skillBlock">
                <h3 class="skillTitle">{s.area}</h3>
                <ul class="skillRows">
                  {s.items.map((i) => (
                    <li class="skillRow">
                      <div class="skillInfo">
                        <span class="skillName">{i.name}</span>
                        <span class="skillLevel">{labelForLevel(i.level)}</span>
                      </div>
                      <div class="skillDots" aria-label={`${i.name} — ${i.years} yrs`} title={`${i.years} yrs • level ${i.level}`}>
                        {Array.from({ length: DOT_COUNT }).map((_, idx) => (
                          <span class={`dot${idx < clampYearsForDots(i.years) ? " filled" : ""}`}></span>
                        ))}
                      </div>
                    </li>
                  ))}
                </ul>
              </article>
            ))}
          </div>
        </section>
      )}

      {r.experience?.length > 0 && (
        <section>
          <h2>Experience</h2>
          {r.experience.map((x) => (
            <article class="item">
              <div class="itemHead">
                <div>
                  <h3>{x.title} — {x.company}</h3>
                  <div class="sub">{x.location}</div>
                </div>
                <div class="dates">{x.start} — {x.end}</div>
              </div>
              {x.bullets?.length > 0 && (
                <ul>
                  {x.bullets.map((b) => <li>{b}</li>)}
                </ul>
              )}
              {x.technologies?.length > 0 && (
                <div class="chips">
                  {x.technologies.map((t) => <span class="chip">{t}</span>)}
                </div>
              )}
            </article>
          ))}
        </section>
      )}

      {r.projects?.length > 0 && (
        <section>
          <h2>Projects</h2>
          {r.projects.map((p) => (
            <article class="item">
              <div class="itemHead">
                <div>
                  <h3>{p.name}</h3>
                  {p.context && <div class="sub">{p.context}</div>}
                </div>
              </div>

              {p.bullets?.length > 0 && (
                <ul>
                  {p.bullets.map((b) => <li>{b}</li>)}
                </ul>
              )}

              {p.technologies?.length > 0 && (
                <div class="chips">
                  {p.technologies.map((t) => <span class="chip">{t}</span>)}
                </div>
              )}
            </article>
          ))}
        </section>
      )}

      {r.education?.length > 0 && (
        <section>
          <h2>Education</h2>
          {r.education.map((e) => (
            <article class="item">
              <div class="itemHead">
                <div>
                  <h3>{e.degree}</h3>
                  <div class="sub">{e.institution} • {e.location}</div>
                </div>
                <div class="dates">{e.graduation_date}</div>
              </div>
              {e.notes && <p class="note">{e.notes}</p>}
            </article>
          ))}
        </section>
      )}

      {r.publications?.length > 0 && (
        <section>
          <h2>Publications</h2>
          {r.publications.map((p) => (
            <article class="item">
              <h3>{p.title}</h3>
              <div class="sub">{p.venue} • {p.year}</div>
              {p.url && <a class="link" href={p.url} target="_blank" rel="noopener">DOI</a>}
            </article>
          ))}
        </section>
      )}

      {fullSkillAreas.length > 0 && (
        <section class="skillGraph">
          <h2>Full Skill Graph</h2>
          <p class="skillLegend">1 dot = 1 year of experience • includes every tool beyond the highlights above</p>
          <div class="skillsGrid skillGraphGrid">
            {fullSkillAreas.map((s) => (
              <article class="skillBlock">
                <h3 class="skillTitle">{s.area}</h3>
                <ul class="skillRows">
                  {s.items.map((i) => (
                    <li class="skillRow">
                      <div class="skillInfo">
                        <span class="skillName">{i.name}</span>
                        <span class="skillLevel">{labelForLevel(i.level)}</span>
                      </div>
                      <div class="skillDots" aria-label={`${i.name} — ${i.years} yrs`} title={`${i.years} yrs • level ${i.level}`}>
                        {Array.from({ length: DOT_COUNT }).map((_, idx) => (
                          <span class={`dot${idx < clampYearsForDots(i.years) ? " filled" : ""}`}></span>
                        ))}
                      </div>
                    </li>
                  ))}
                </ul>
              </article>
            ))}
          </div>
        </section>
      )}
    </main>
  </body>
</html>
